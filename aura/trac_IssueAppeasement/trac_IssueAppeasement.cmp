<!--
 - @description Issue loyalty point appeasements to a specified loyalty member
 - @author      Alex Kong, Traction on Demand
 - @date        2020-05-21
 -->

<aura:component description="trac_IssueAppeasement"
                extends="c:trac_BaseComponent"
                implements="force:hasRecordId,flexipage:availableForAllPageTypes"
                controller="trac_IssueAppeasementController"
                access="global">

    <aura:attribute name="loyalty" type="Object" />
    <aura:attribute name="contactId" type="Id" description="The customer contact ID" />
    <aura:attribute name="appeasePoints" type="Integer" description="The amount of points to award" />
    <aura:attribute name="appeaseValue" type="String" />
    <aura:attribute name="pointsAvailable" type="Integer" default="0" />
    <aura:attribute name="finalPointBalance" type="String" />
    <aura:attribute name="showSpinner" type="Boolean" default="false" />

    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:handler name="change" value="{!v.appeasePoints}" action="{!c.selectAmount}"/>

    <aura:registerEvent name="closeModalEvent" type="c:trac_CloseModalApplicationEvent"/>

    <div>
        <p class="slds-text-heading--medium slds-m-bottom--large">Points to Award</p>

        <lightning:messages/>

        <div>
            <div class="slds-is-relative">
                <lightning:spinner aura:id="spinner" variant="brand" class="{!v.showSpinner ? '' : 'slds-hide' }" size="large" alternativeText="Please wait..."/>
            </div>

            <div class="slds-form--stacked" onkeyup="{!c.formPress}">
                <lightning:input aura:id="amount" label="Points Amount"
                                 name="amount"
                                 value="{!v.appeasePoints}"
                                 type="text"
                                 pattern="[0-9]+"
                                 required="true"/>
            </div>
        </div>

        <p class="{!(and(v.appeasePoints != null, v.appeasePoints > 0) ? 'slds-show' : 'slds-hide') + ' slds-m-top--large'}">
            The customer will be awarded <lightning:formattedNumber value="{!v.appeasePoints}" maximumFractionDigits="0"/> points,
            worth <lightning:formattedNumber style="currency" value="{!v.appeaseValue}"/> CAD
            at time of redemption.  Their new point balance will be <lightning:formattedNumber value="{!v.finalPointBalance}" maximumFractionDigits="0"/>
            points. An email confirmation will be sent regarding this.
        </p>

        <div class="slds-m-top--large slds-align--absolute-center">
            <lightning:button label="Submit Appeasement" disabled="{!v.showSpinner}" onclick="{!c.submitAppeasementForm}" />
        </div>

    </div>

</aura:component>